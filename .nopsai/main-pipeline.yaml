name: Second-Test-Pipeline
description: A sample pipeline.
llm_content_sharing: true
llm_output_sharing: true
display_options:
  github_view: "flat" # mermaid, tree or flat
container_image: "pipeline-image:latest"
working_directory: "/tmp/test"
timeout: "20m"
environment:
  API_VERSION: "v1"
  DOCKER_HOST: "tcp://192.168.1.16:2375"
steps:
  - name: preparation
    image: pipeline-image:latest
    secrets:
      - TEST_SECRET
    tasks:
      - name: git-clone
        ignore_failure: false
        script: |
          #!/bin/bash
          git clone https://github.com/hosein-yousefii/test-app.git
          echo $TEST_SECRET

      - name: waiting-time
        goal: wait for 2 seconds
        llm_output_sharing: false
        depends_on:
        - git-clone

      - name: list-envs-containers
        script: |
          #!/bin/bash
          env
          echo $TEST_SECRET
        depends_on:
        - git-clone

      - name: branch-versioning
        goal: "Change branch to nopsai-test and get the latest tag"
        depends_on:
        - git-clone

      - name: commit-hash
        goal: "what is the commit hash?"
        depends_on:
        - branch-versioning

  - name: secret-validation
    image: ubuntu:latest
    secrets:
      - TEST_SECRET
    tasks:
      - name: write-secret
        goal: write the value of TEST_SECRET env to sample.txt

      - name: test-secret
        script: |
          #!/bin/bash
          cat sample.txt
        depends_on:
        - write-secret

  - name: docker-builder
    tasks:
      - name: dockerfile-modification
        goal: "Modify Dockerfile and add copy statement to add docker-compose"
        depends_on:
        - branch-versioning

      - name: dockerfile-content
        goal: "show dockerfile content"
        llm_output_sharing: false
        depends_on:
        - dockerfile-modification

      - name: build-docker
        goal: build docker image with repo name and 3 tag, latest,latest git tag and commit hash 
        depends_on:
        - commit-hash
        - dockerfile-modification

  - name: Check-steps
    goal: "Give me lines from history which are important"
    image: alpine:latest
    llm_output_sharing: false
    depends_on:
    - build-docker

  - name: report
    goal: "provide a report of all steps"
    depends_on:
    - build-docker
