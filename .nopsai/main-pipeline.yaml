name: Second-Test-Pipeline
description: A sample pipeline.
llm_content_sharing: true
llm_output_sharing: true
display_options:
  github_view: "mermaid" # mermaid, tree or flat
container_image: "pipeline-image:latest"
working_directory: "/tmp/test"
timeout: "20m"
environment:
  API_VERSION: "v1"
  DOCKER_HOST: "tcp://192.168.1.16:2375"
steps:
  - name: git-clone
    script: |
      #!/bin/bash
      git clone https://github.com/hosein-yousefii/test-app.git
      echo $TEST_SECRET
    session: pipeline-image
    ignore_failure: false
    
  - name: write-secret
    goal: write the value of TEST_SECRET env to sample.txt
    image: ubuntu:latest
    session: ubuntu-latest-usage
    secrets:
      - TEST_SECRET
      
  - name: waiting-time
    goal: wait for 2 seconds
    session: pipeline-image
    llm_output_sharing: false
    depends_on:
    - git-clone

  - name: list-envs-containers
    session: pipeline-image
    secrets:
      - TEST_SECRET
    script: |
      #!/bin/bash
      env
      echo $TEST_SECRET
    depends_on:
    - git-clone

  - name: branch-versioning
    goal: "Change branch to nopsai-test and get the latest tag"
    session: pipeline-image
    depends_on:
    - git-clone

  - name: dockerfile-modification
    goal: "Modify Dockerfile and add copy statement to add docker-compose"
    session: pipeline-image-docker
    depends_on:
    - branch-versioning

  - name: dockerfile-content
    goal: "show dockerfile content"
    session: pipeline-image-docker
    llm_output_sharing: false
    depends_on:
    - dockerfile-modification

  - name: commit-hash
    goal: "what is the commit hash?"
    session: pipeline-image
    depends_on:
    - branch-versioning

  - name: test-secret
    script: |
      #!/bin/bash
      cat sample.txt
    image: ubuntu:latest
    session: ubuntu-latest-usage
    depends_on:
    - write-secret

  - name: build-docker
    goal: build docker image with repo name and 3 taga, latest,latest git tag and commit hash 
    session: pipeline-image-docker
    depends_on:
    - commit-hash
    - dockerfile-modification

  - name: report
    goal: "provide a report of all steps"
    depends_on:
    - build-docker
