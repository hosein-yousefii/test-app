name: Second Test Pipeline
description: A sample pipeline.
display_options:
  github_view: "mermaid" # tree or flat
llm_content_sharing: true   # by default it's true
llm_output_sharing: true    # by default it's true
container_image: "pipeline-image:latest"
working_directory: "/tmp/test"
timeout: "20m"
environment:
  API_VERSION: "v1"
  DOCKER_HOST: "tcp://192.168.1.16:2375"
steps:
  - name: git-clone
    script: |
      #!/bin/bash
      git clone https://github.com/hosein-yousefii/test-app.git
    ignore_failure: false

  - name: waiting-time
    goal: wait for 2 seconds
    image: ubuntu:latest
    llm_output_sharing: false
    depends_on:
    - git-clone

  - name: list-envs
    image: alpine:latest
    script: |
      #!/bin/bash
      env
    depends_on:
    - git-clone

  - name: branch-versioning
    goal: "Change branch to nopsai-test and get the latest tag"
    depends_on:
    - git-clone

  - name: dockerfile-modification
    goal: "Modify Dockerfile and add copy statement to add docker-compose"
    depends_on:
    - branch-versioning

  - name: dockerfile-content
    goal: "show dockerfile content"
    llm_output_sharing: false
    depends_on:
    - dockerfile-modification

  - name: commit-hash
    goal: "what is the commit hash?"
    depends_on:
    - branch-versioning

  - name: failure
    goal: "fail the step"
    ignore_failure: true

  - name: build-docker
    goal: build docker image with repo name and 3 taga, latest,latest git tag and commit hash 
    depends_on:
    - commit-hash
    - dockerfile-modification

  - name: report
    goal: "provide a report of all steps"
    image: alpine:latest
    depends_on:
    - build-docker
